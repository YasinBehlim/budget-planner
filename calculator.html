<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Calculator - PakBudget</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #f8f9fc;
      color: #212529;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main { flex: 1; }
    .card {
      background: white;
      border: none;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }
    .form-control, .form-control:focus {
      background: #ffffff;
      border: 2px solid #e9ecef;
      border-radius: 14px;
      font-size: 1.1rem;
    }
    .form-control:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.15);
    }
    .btn-primary {
      background: #0d6efd;
      border: none;
      border-radius: 14px;
      font-weight: 600;
      padding: 12px;
    }
    .btn-outline-primary {
      border: 2px solid #0d6efd;
      color: #0d6efd;
    }
    .table { background: white; }
    .table thead th { background: #f1f3f5; font-weight: 600; }
    input[type=number] { text-align: right; font-weight: 600; font-size: 1.05rem; }
    .header {
      background: linear-gradient(135deg, #0d6efd, #3b82f6);
      color: white;
      padding: 1.2rem 0;
    }
    .nav-link { color: rgba(255,255,255,0.9); font-weight: 500; }
    .nav-link.active { color: white; font-weight: 700; text-decoration: underline; }
    footer { background: #f1f3f5; color: #6c757d; }
    .text-accent { color: #0d6efd; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg header">
    <div class="container">
      <a class="navbar-brand fw-bold fs-3" href="index.html">PakBudget</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto">
          <li><a class="nav-link" href="index.html">Home</a></li>
          <li><a class="nav-link active" href="calculator.html">Calculator</a></li>
          <li><a class="nav-link" href="tips.html">Tips</a></li>
          <li><a class="nav-link" href="privacy-policy.html">Privacy</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <h1 class="text-center mb-5 fw-bold text-accent">Monthly Budget Calculator</h1>

    <!-- Income -->
    <div class="card mb-4 p-4">
      <label class="form-label fw-semibold fs-5">Monthly Income (PKR)</label>
      <input type="number" id="income" class="form-control form-control-lg" placeholder="150000" oninput="saveData(); calculate()">
    </div>

    <!-- Add Expense -->
    <div class="card mb-4 p-4">
      <h5 class="mb-3">Add Expense</h5>
      <div class="row g-3">
        <div class="col-md-5">
          <input type="text" id="cat" class="form-control" placeholder="Category (e.g. Rent)">
        </div>
        <div class="col-md-4">
          <input type="number" id="amt" class="form-control" placeholder="Amount">
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary w-100" onclick="addExpense()">
            <i class="fas fa-plus"></i> Add
          </button>
        </div>
      </div>
      <button class="btn btn-outline-primary mt-3 w-100" onclick="loadCommonCategories()">
        <i class="fas fa-list-ul"></i> Load Common Categories
      </button>
    </div>

    <!-- Expenses Table -->
    <div class="card mb-4 p-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>Your Expenses</h5>
        <button class="btn btn-sm btn-outline-danger" onclick="clearAll()">Clear All</button>
      </div>
      <table class="table table-hover" id="expTable">
        <thead><tr><th>Category</th><th class="text-end">Amount (PKR)</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
      <h5 class="text-end fw-bold mt-3" id="totalExp">Total Expenses: 0 PKR</h5>
    </div>

    <!-- Results + Chart -->
    <div class="row g-4">
      <div class="col-lg-5">
        <div class="card p-5 text-center">
          <h4 class="mb-4">Your Results</h4>
          <div class="mb-5">
            <p class="text-muted mb-1">Monthly Savings</p>
            <h2 id="savings" class="fw-bold text-success">0 PKR</h2>
          </div>
          <div>
            <p class="text-muted mb-1">Savings Rate</p>
            <h2 id="savPct" class="fw-bold">0%</h2>
          </div>
          <button class="btn btn-outline-primary w-100 mt-5" onclick="exportCSV()">
            <i class="fas fa-download"></i> Export to CSV
          </button>
        </div>
      </div>
      <div class="col-lg-7">
        <div class="card p-4">
          <h5 class="mb-3">Spending Breakdown</h5>
          <canvas id="myChart" height="340"></canvas>
        </div>
      </div>
    </div>
  </main>

  <footer class="py-4 text-center">
    © 2026 PakBudget • Free Pakistan Budget Planner
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let expenses = [];
    let chartInstance = null;

    function saveData() {
      localStorage.setItem("budgetIncome", document.getElementById("income").value);
      localStorage.setItem("budgetExpenses", JSON.stringify(expenses));
    }

    function loadData() {
      const savedIncome = localStorage.getItem("budgetIncome");
      if (savedIncome) document.getElementById("income").value = savedIncome;

      const saved = localStorage.getItem("budgetExpenses");
      if (saved) expenses = JSON.parse(saved);
      updateTable();
      calculate();
    }

    function addExpense() {
      const cat = document.getElementById("cat").value.trim();
      const amt = parseFloat(document.getElementById("amt").value) || 0;
      if (cat) {
        expenses.push({cat, amt});
        updateTable();
        saveData();
        calculate();
        document.getElementById("cat").value = "";
        document.getElementById("amt").value = "";
      }
    }

    function updateAmount(i, val) {
      expenses[i].amt = parseFloat(val) || 0;
      updateTable();
      saveData();
      calculate();
    }

    function updateTable() {
      const tbody = document.querySelector("#expTable tbody");
      tbody.innerHTML = "";
      let total = 0;

      expenses.forEach((item, i) => {
        total += item.amt;
        tbody.innerHTML += `
          <tr>
            <td>${item.cat}</td>
            <td class="text-end">
              <input type="number" class="form-control d-inline-block w-32" value="${item.amt}" onchange="updateAmount(${i}, this.value)">
            </td>
            <td><button class="btn btn-sm text-danger" onclick="removeExpense(${i})"><i class="fas fa-trash"></i></button></td>
          </tr>`;
      });

      document.getElementById("totalExp").textContent = `Total Expenses: ${total.toLocaleString()} PKR`;
    }

    function removeExpense(i) {
      expenses.splice(i, 1);
      updateTable();
      saveData();
      calculate();
    }

    function clearAll() {
      if (confirm("Clear everything?")) {
        expenses = [];
        document.getElementById("income").value = "";
        updateTable();
        saveData();
        calculate();
      }
    }

    function calculate() {
      const income = parseFloat(document.getElementById("income").value) || 0;
      const totalExp = expenses.reduce((s, e) => s + e.amt, 0);
      const savings = income - totalExp;
      const pct = income > 0 ? Math.round((savings / income) * 100) : 0;

      document.getElementById("savings").textContent = savings.toLocaleString() + " PKR";
      document.getElementById("savings").className = savings >= 0 ? "fw-bold text-success" : "fw-bold text-danger";
      document.getElementById("savPct").textContent = pct + "%";

      const ctx = document.getElementById("myChart").getContext("2d");
      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["Savings", ...expenses.map(e => e.cat)],
          datasets: [{
            data: [Math.max(savings, 0), ...expenses.map(e => e.amt)],
            backgroundColor: ["#0d6efd", "#28a745", "#ffc107", "#fd7e14", "#6f42c1", "#20c997", "#e83e8c", "#17a2b8"],
            borderColor: "#ffffff",
            borderWidth: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { position: "bottom", labels: { padding: 20, font: { size: 14 } } } }
        }
      });
    }

    function loadCommonCategories() {
      expenses = [
        {cat: "Rent", amt: 0}, {cat: "Electricity & Gas", amt: 0},
        {cat: "Groceries", amt: 0}, {cat: "Transport", amt: 0},
        {cat: "School Fees", amt: 0}, {cat: "Internet + Mobile", amt: 0},
        {cat: "Medical", amt: 0}, {cat: "Eating Out", amt: 0},
        {cat: "Savings / Investments", amt: 0}
      ];
      updateTable();
      saveData();
      calculate();
    }

    function exportCSV() {
      if (expenses.length === 0) return alert("Nothing to export!");
      let csv = "Category,Amount (PKR)\n";
      expenses.forEach(e => csv += `"${e.cat}",${e.amt}\n`);
      const income = document.getElementById("income").value || 0;
      csv += `Income,${income}\nSavings,${income - expenses.reduce((s,v)=>s+v.amt,0)}\n`;
      const blob = new Blob([csv], {type: "text/csv"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "my-budget.csv";
      a.click();
    }

    window.onload = loadData;
  </script>
</body>
</html>
